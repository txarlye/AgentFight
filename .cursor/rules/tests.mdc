---
description: EstÃ¡ndares para organizaciÃ³n y creaciÃ³n de tests - Estructura de carpetas y nomenclatura
globs: ["**/tests/**", "**/test_*.py", "**/*_test.py"]
alwaysApply: true
---

# ESTÃNDARES PARA TESTS

## ğŸ“ ESTRUCTURA DE CARPETAS

### **UbicaciÃ³n Principal**:
- **Todos los tests** deben estar en `tests/`
- **OrganizaciÃ³n por categorÃ­as** en subcarpetas especÃ­ficas
- **Nomenclatura clara** para identificar el propÃ³sito

### **Estructura Recomendada**:
```
tests/
â”œâ”€â”€ Agents/                    # Tests de agentes de IA
â”‚   â”œâ”€â”€ test_ollama_*.py
â”‚   â”œâ”€â”€ test_gemini_*.py
â”‚   â””â”€â”€ test_langsmith_*.py
â”œâ”€â”€ UI/                       # Tests de interfaz de usuario
â”‚   â”œâ”€â”€ test_streamlit_*.py
â”‚   â”œâ”€â”€ test_console_*.py
â”‚   â””â”€â”€ test_gradio_*.py
â”œâ”€â”€ BBDD/                     # Tests de base de datos
â”‚   â”œâ”€â”€ test_cargar_*.py
â”‚   â”œâ”€â”€ test_guardar_*.py
â”‚   â””â”€â”€ test_municipios_*.py
â”œâ”€â”€ Procesamiento/            # Tests de procesamiento general
â”‚   â”œâ”€â”€ test_paralelo_*.py
â”‚   â”œâ”€â”€ test_boe_*.py
â”‚   â””â”€â”€ test_boa_*.py
â”œâ”€â”€ Patrones/                 # Tests de sistema de patrones
â”‚   â”œâ”€â”€ test_patrones_*.py
â”‚   â”œâ”€â”€ test_memoria_*.py
â”‚   â””â”€â”€ test_guardado_*.py
â”œâ”€â”€ Entidades/                # Tests de extracciÃ³n de entidades
â”‚   â”œâ”€â”€ test_municipio_*.py
â”‚   â”œâ”€â”€ test_expediente_*.py
â”‚   â””â”€â”€ test_promotor_*.py
â””â”€â”€ Integration/              # Tests de integraciÃ³n
    â”œâ”€â”€ test_completo_*.py
    â”œâ”€â”€ test_flow_*.py
    â””â”€â”€ test_sistema_*.py
```

## ğŸ¯ CATEGORÃAS DE TESTS

### **1. Agents** - Tests de Agentes de IA:
- Tests de Ollama, Gemini, OpenAI
- Tests de LangSmith
- Tests de configuraciÃ³n de agentes
- Tests de lÃ­mites de consumo

### **2. UI** - Tests de Interfaz de Usuario:
- Tests de Streamlit
- Tests de consola
- Tests de Gradio
- Tests de componentes UI

### **3. BBDD** - Tests de Base de Datos:
- Tests de carga de datos
- Tests de guardado
- Tests de municipios
- Tests de conexiÃ³n

### **4. Procesamiento** - Tests de Procesamiento:
- Tests de procesamiento paralelo
- Tests de BOE/BOA
- Tests de automatizaciÃ³n
- Tests de rendimiento

### **5. Patrones** - Tests de Sistema de Patrones:
- Tests de patrones
- Tests de memoria
- Tests de guardado
- Tests de categorizaciÃ³n

### **6. Entidades** - Tests de ExtracciÃ³n:
- Tests de municipios
- Tests de expedientes
- Tests de promotores
- Tests de rangos

### **7. Integration** - Tests de IntegraciÃ³n:
- Tests completos del sistema
- Tests de flujo end-to-end
- Tests de integraciÃ³n con servicios externos

## ğŸ“ NOMENCLATURA DE ARCHIVOS

### **PatrÃ³n de Nombres**:
```python
# Tests especÃ­ficos
test_[categoria]_[funcionalidad].py
test_[categoria]_[componente]_[accion].py

# Ejemplos:
test_agents_ollama_config.py
test_ui_streamlit_sidebar.py
test_bbdd_cargar_municipios.py
test_procesamiento_paralelo_boe.py
test_patrones_memoria_guardado.py
test_entidades_expediente_extraccion.py
test_integration_completo_sistema.py
```

### **Tests de Debug/DiagnÃ³stico**:
```python
# Tests de debug especÃ­ficos
test_debug_[categoria]_[problema].py
test_diagnostico_[componente].py

# Ejemplos:
test_debug_agents_ollama_404.py
test_diagnostico_paralelo_procesamiento.py
```

## ğŸ”§ CREACIÃ“N DE NUEVOS TESTS

### **Proceso Obligatorio**:

1. **Identificar CategorÃ­a**:
   - Â¿QuÃ© componente se estÃ¡ testeando?
   - Â¿Existe subcarpeta apropiada?

2. **Crear Subcarpeta si es Necesario**:
   ```bash
   # Si no existe categorÃ­a apropiada
   mkdir tests/NuevaCategoria
   ```

3. **Crear Archivo de Test**:
   ```python
   # tests/[Categoria]/test_[categoria]_[funcionalidad].py
   ```

4. **Seguir Estructura de Test**:
   ```python
   import unittest
   import sys
   import os
   
   # AÃ±adir ruta del proyecto
   sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   
   class TestCategoriaFuncionalidad(unittest.TestCase):
       def setUp(self):
           # ConfiguraciÃ³n inicial
           pass
       
       def test_funcionalidad_especifica(self):
           # Test especÃ­fico
           pass
       
       def tearDown(self):
           # Limpieza
           pass
   
   if __name__ == '__main__':
       unittest.main()
   ```

## ğŸ“‹ ESTRUCTURA DE TEST

### **Template EstÃ¡ndar**:
```python
"""
Test para [Categoria] - [Funcionalidad]
DescripciÃ³n clara del propÃ³sito del test
"""

import unittest
import sys
import os
from unittest.mock import patch, MagicMock

# AÃ±adir ruta del proyecto
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# Imports especÃ­ficos del proyecto
from settings.settings import settings
# from procesamiento.[modulo] import [clase]

class TestCategoriaFuncionalidad(unittest.TestCase):
    """Tests para [categoria] - [funcionalidad]"""
    
    def setUp(self):
        """ConfiguraciÃ³n inicial para cada test"""
        # ConfiguraciÃ³n comÃºn
        pass
    
    def tearDown(self):
        """Limpieza despuÃ©s de cada test"""
        # Limpieza comÃºn
        pass
    
    def test_funcionalidad_basica(self):
        """Test de funcionalidad bÃ¡sica"""
        # Arrange
        # Act
        # Assert
        pass
    
    def test_caso_error(self):
        """Test de manejo de errores"""
        # Test de casos de error
        pass
    
    def test_caso_limite(self):
        """Test de casos lÃ­mite"""
        # Test de casos lÃ­mite
        pass

if __name__ == '__main__':
    unittest.main()
```

## ğŸ¯ REGLAS ESPECÃFICAS

### **Para Tests de Agentes**:
- Usar mocks para llamadas a IA
- Testear lÃ­mites de consumo
- Verificar configuraciÃ³n de proveedores

### **Para Tests de UI**:
- Usar Streamlit testing utilities
- Testear componentes por separado
- Verificar estados de la interfaz

### **Para Tests de BBDD**:
- Usar base de datos de prueba
- Limpiar datos despuÃ©s de cada test
- Testear transacciones

### **Para Tests de Procesamiento**:
- Testear procesamiento paralelo vs secuencial
- Verificar rendimiento
- Testear manejo de errores

### **Para Tests de Patrones**:
- Testear memoria de patrones
- Verificar persistencia
- Testear categorizaciÃ³n

## âœ… CHECKLIST PARA NUEVOS TESTS

- [ ] Â¿EstÃ¡ en la carpeta `tests/`?
- [ ] Â¿EstÃ¡ en la subcarpeta correcta?
- [ ] Â¿Sigue la nomenclatura `test_[categoria]_[funcionalidad].py`?
- [ ] Â¿Tiene docstring descriptivo?
- [ ] Â¿Incluye setUp y tearDown?
- [ ] Â¿Testea casos bÃ¡sicos, errores y lÃ­mites?
- [ ] Â¿Usa mocks apropiados?
- [ ] Â¿Limpia recursos despuÃ©s del test?

## ğŸš€ COMANDOS ÃšTILES

### **Ejecutar Tests**:
```bash
# Test especÃ­fico
python tests/[categoria]/test_[nombre].py

# Todos los tests de una categorÃ­a
python -m unittest tests.[categoria].*

# Todos los tests
python -m unittest discover tests/
```

### **Crear Nueva CategorÃ­a**:
```bash
mkdir tests/NuevaCategoria
touch tests/NuevaCategoria/__init__.py
```

---

**Esta regla define la organizaciÃ³n y estÃ¡ndares para tests en el proyecto iaBoletin.**